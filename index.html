<!DOCTYPE html>
<html>

<head>
    <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous"> -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@forevolve/bootstrap-dark@1.0.0/dist/css/bootstrap-dark.min.css" />
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />

    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>augmero physics</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <link rel='stylesheet' type='text/css' media='screen' href='main.css'>
    <script src='main.js'></script>
</head>

<body>
    <div class="content" style="padding: 2em;">

        <a class="augmero-anchor" id="augmero-janchor-top"></a>

        <h2 style="position: sticky; top:40px; float:right; background-color: rgba(0,0,0,.6); display: flex; flex-flow:column; padding: .2em .6em .4em .6em; border-radius: 15px;">
            <a href="#augmero-janchor-top">Top</a>
            <a href="#augmero-janchor-overview">Overview</a>
            <a href="#augmero-janchor-step1">Step 1</a>
            <a href="#augmero-janchor-step2">Step 2</a>
            <a href="#augmero-janchor-step3">Step 3</a>
            <a href="#augmero-janchor-step4">Step 4</a>
            <a href="#augmero-janchor-step5">Step 5</a>
            <a href="#augmero-janchor-clothing">Clothing</a>
            <a href="#augmero-janchor-expansion">Expansion</a>
            <a href="#augmero-janchor-resources">Resources</a>
        </h2>

        <h1>augmero's physics workflow - Ziva Dynamics for Blender</h1>

        <h2>Disclaimer:</h2>
        <p>This is an experimental workflow. I am not an expert and I don't necessarily recommend anybody actually do this.</p>
        <p>If you are new to Blender or 3D this post is probably not for you, but bookmark it for later if you're interested</p>
        <p>However, if you are looking beyond Blender native physics I hope some of these notes will be useful! </p>
        <p>If you found this page and don't know who augmero is, fair warning some links are going to be NSFW. While this workflow can be useful for more general applications, I am using it for NSFW content</p>
        <p>If you're curious what kind of results I'm getting I post here and on <a href="https://twitter.com/augmero_nsfw" target="_blank">Twitter</a></p>
        <p>Lastly, if you have ideas / improvements let me know! I'll keep this post updated</p>

        <p>
            <hr>
        </p><br>
        <h2>Tools:</h2>
        <ol>
            <li>Blender</li>
            <li>Maya + Ziva Dynamics plugin</li>
            <li>autoremesher (linked in step 2)</li>
        </ol>

        <p>
            <hr>
        </p><br>
        <h2>What is Ziva Dynamics?</h2>
        <ul>
            <li>
                Ziva Dynamics is a plugin for Maya that specializes in character physics simulation and deformations.
            </li>
            <li>
                Magic
            </li>
            <li>
                Check out this lion: <a href="https://www.youtube.com/watch?v=vsTP6Ldm7Yo">https://www.youtube.com/watch?v=vsTP6Ldm7Yo</a>
            </li>
            <li>For something more relevant to this post you can take a look at my recent <a href="https://twitter.com/augmero_nsfw" target="_blank">animations</a></li>
            <li>I first found out about this software when I saw tweets from <a href="https://twitter.com/m_tsqn" target="_blank">m.tsqn</a>, definitely check out what they've made as well</li>
        </ul>

        <p>
            <hr>
        </p><br>
        <h2>Why not just use Maya?</h2>
        <ul>
            <li>
                Many models and shared resources online have armatures and python scripts for Blender with no Maya version, it's not easy to port things to Maya
            </li>
            <li>
                Most of my experience and workflows (modeling, sculpting, rendering, materials, etc) is in Blender/Cycles, re-learning all of that stuff for Maya is a lot
            </li>
        </ul>


        <a class="augmero-anchor" id="augmero-janchor-overview"></a>
        <p>
            <hr>
        </p><br>
        <h2>Overview</h2>

        <p>Generally, this follows the Mesh Deform bind to cage workflow that's common with blender native physics, just instead of blender cloth or soft body we're outsourcing this work to the Ziva Dynamics plugin in Maya.</p>
        <p>If you're not familiar, here's a good tutorial from <a href="https://twitter.com/rikolo3d" target="_blank">Rikolo3D</a> that describes the Blender native version: <a href="https://www.newgrounds.com/portal/view/807659" target="_blank">https://www.newgrounds.com/portal/view/807659</a> </p>
        <p>
            Before I go any further I also want to link this elephant tutorial for Ziva which is super helpful
            <a href="https://www.youtube.com/watch?v=QA6C9xzf4f8" target="_blank">https://www.youtube.com/watch?v=QA6C9xzf4f8</a>
        </p>

        <p>These are the general steps for my workflow:</p>
        <ol>
            <li>Make an animation with any model in Blender</li>
            <li>Make physics cage(s), export to Maya</li>
            <li>Set up and run Ziva physics sim in Maya</li>
            <li>Export Ziva physics sim, import to blender</li>
            <li>Mesh deform your original model</li>
        </ol>
        <p>Now it's time to get into the details</p>
        <a class="augmero-anchor" id="augmero-janchor-step1"></a>
        <p>
            <hr>
        </p><br>

        <h2>Step 1 - General set-up</h2>
        <ul>
            <li>Set up character model with the most general desired shape (likely default pose, shape keys set up for body proportions</li>
            <ul>
                <li>You will be able to make adjustments (and animate adjustments) in Ziva as well but a good base gets
                    better results</li>
            </ul>
            <li>Any simple animation is fine starting out, even an existing animation you want to add physics to</li>
            <li>This will be important later, pick a frame where the physics simulation is going to start (I use frame 3) and make sure that your armature stays the same way at that frame.</li>
            <ul>
                <li>I recommend setting keyframes of the rest pose for the most consistency and ease of use.</li>
            </ul>
            <li>General project layout</li>
            <ul>
                <li>It helps to have separate collections in blender for rendering and rigging.</li>
            </ul>
            <li>Make vertex group for separating the armature vs mesh deform</li>
            <ul>
                <li>This will be tweaked later on the render mesh after binding</li>
                <li>Since this is a mesh deform flow, I recommend excluding more complex parts of the geometry in the physics</li>
                <ul>
                    <li>Generally, this includes the head, hands, feet, gens.</li>
                    <li>I include hands as a bone, not part of the tissue cage</li>
                </ul>
                <li>We will use this vertex group later for the first two modifiers on the render mesh like this:</li>
                <li><img src="https://i.imgur.com/lft8fgy.png" alt="First two modifiers screenshot"></li>
            </ul>
        </ul>

        <a class="augmero-anchor" id="augmero-janchor-step2"></a>
        <p>
            <hr>
        </p><br>
        <h2>Step 2 - Building the exports for Maya, and then exporting them</h2>
        <p>There are many ways to prepare your tissues and bones for Ziva, if you've got a better way let me know!</p>
        <p>Ziva is picky about what it lets you use as a tissue or bone. If you run into issues here's some documentation on what Ziva is looking for <a href="https://docs.Zivadynamics.com/vfx/mel_commands/zMeshCheck.html" target="_blank">zMeshCheck</a>
        </p>
        <h3>zBone example: hands</h3>
        <p>Hands don't work too well with mesh deform so I leave them to my model's armature and use them in Ziva as a zBone for some nice collisions</p>
        <p>This will be a new mesh based on the original as part of my Ziva Pickiness Resolution Process</p>
        <ol>
            <li>Duplicate the model's mesh and remove all irrelevant vertices</li>
            <ul>
                <li>Optionally, fill the holes with grid fill or any way you prefer, this can help the Blender remesh look better</li>
            </ul>
            <li>Add a remesh modifier</li>
            <ul>
                <li>This can be fairly high vertex count, we're fixing the topology afterwards anyways</li>
                <li><img src="https://i.imgur.com/bsAiMO0.png" alt="blender remesh screenshot"></li>
            </ul>
            <li>Now it's time to retopologize. My favorite tools for automatic topology / remeshing are
                <a href="https://github.com/huxingyi/autoremesher/releases" target="_blank">huxingyi/autoremesher</a> and <a href="https://github.com/wjakob/instant-meshes" target="_blank">wjakob/instant-meshes</a>,
                they work in a similar fashion
            </li>
            <ol>
                <li>Export the Blender mesh as a .obj file</li>
                <li>Open it in either of the programs, pick your preferred density of vertices and save it</li>
                <ul>
                    <li>I recommend keeping the density of all the meshes that are going to be part of the Ziva simulationfairly similar, doesn't have to be perfect</li>
                </ul>
                <li>Save</li>
            </ol>
            <li>Import the new mesh into Blender</li>
            <li>Now for a cool trick, copy the vertex groups from your original mesh onto your new one using the data
                transfer modifier </li>
            <ul>
                <li>Click on 'Generate Data Layers' first and then apply the modifier</li>
                <li>Make sure the two meshes are overlapping, maybe put your armature in rest pose for this section</li>
                <li><img src="https://i.imgur.com/KkvxZna.png" alt="Data transfer modifier screenshot"></li>
            </ul>
            <li>This will look pretty decent, but you will notice some deformation artifacts during the animation due to the
                new mesh not exactly matching the old one. I like to add a corrective smooth modifier with maybe 10 repeats
                after the armature to help with this</li>
        </ol>

        <h3>zTissue example: body physics cage</h3>
        <p>There are a lot of similar steps to the above zBone example here, so I'll cut the notes on repeated steps</p>
        <p>Because we will be using mesh deform with the results of this cage once it gets out of Ziva, we should test it with mesh deform before exporting</p>
        <ol>
            <li>Duplicate the model's mesh and remove all irrelevant vertices</li>
            <li>Add a remesh modifier</li>
            <li>Retopologize</li>
            <ol>
                <li>Export the Blender mesh as a .obj file</li>
                <li>Open it in either of the programs, pick your preferred density of vertices and save it</li>
                <li>Save</li>
            </ol>
            <li>Import the new mesh into Blender</li>
            <li><strong>NEW STEP - IMPORTANT: </strong>Use a mix of displace, shrinkwrap, and sculpting to make sure the character's mesh is all contained within this new mesh.</li>
            <ul>
                <li>You can test if your cage is good by adding and binding the mesh deform onto your character, and then adding modifiers to the cage to make sure all the vertices are affected</li>
                <li><img src="https://i.imgur.com/5ukOwFO.png" alt="tissue cage example modifiers screenshot"></li>
            </ul>
            <li>Copy the vertex groups from your original mesh onto your new one using the data
                transfer modifier </li>
            <ul>
                <li>Click on 'Generate Data Layers' first and then apply the modifier</li>
                <li>Make sure the two meshes are overlapping, maybe put your armature in rest pose for this section</li>
            </ul>
            <li>Clean up deformation artifacts with corrective smooth modifier</li>
        </ol>

        <h3>Exporting to Maya</h3>
        <p>Now that you have all of these excellent and prepared meshes, it's export time</p>
        <p>There are multiple exports we have to do</p>
        <ol>
            <li>Base export</li>
            <ul>
                <li>Export as FBX, here are the settings I use: </li>
                <li><img src="https://i.imgur.com/ACyb85c.png" alt="Maya mesh export screenshot"></li>
            </ul>
            <li>Animated export</li>
            <ul>
                <li>This is an alembic export, for performance reasons I recommend excluding from view layer collections of
                    anything that's not being exported</li>
                <li>Here's a <a href="https://github.com/augmero/blender-alembic-bulk-exporter" target="_blank">python script</a> which I made to batch export the animated versions of my meshes, to use it
                    you have to go and read the documentation in the script</li>
            </ul>
        </ol>

        <a class="augmero-anchor" id="augmero-janchor-step3"></a>
        <p>
            <hr>
        </p><br>
        <h2>Step 3 - Set up the Ziva sim in Maya and run it</h2>
        <p>
            The elephant tutorial can probably teach the basics of Ziva better than me, here's a link again
            <a href="https://www.youtube.com/watch?v=QA6C9xzf4f8" target="_blank">https://www.youtube.com/watch?v=QA6C9xzf4f8</a>
        </p>
        <p>The elephant tutorial is quite similar to what I do, but my alembics are coming from Blender instead</p>
        <p>I use some pieces from this <a href="https://www.turbosquid.com/3d-models/body-skeleton-blend-free/659093" target="_blank">random turbosquid skeleton model from 2012</a> like the ribcage and pelvis for zbone attachments but I don't think it's necessary or even useful when we have the animated version of the cage to attach to</p>
        <p>However, there are some specific notes I'd like to share </p>
        <h3>General Steps</h3>
        <ol>
            <li>Set your Maya framerate to the same framerate you use in Blender, 60 in my case</li>
            <ul>
                <li>I don't render at 60fps because that'd take forever, I set step to 2 and get 30fps </li>
            </ul>
            <li>Import Blender alembic files into Maya</li>
            <li>Import Blender FBX files into Maya</li>
            <li>Make a blend shape on the static fbx pointing to the animated alembic (set envelope to 1)</li>
            <li>Duplicate the static FBX, it's going to do two different things</li>
            <li>One version of the static FBX is now going to become part of the physics sim, make it a zTissue</li>
            <li>The other version of the static FBX is now going to become a zBone with no collisons for attaching the zTissue to</li>
            <li>Make attachments from the tissue to the now-animated fbx </li>
            <ul>
                <li>Make sure to set high strength attachments on parts where the cage is next to vertices that won't be part of the mesh deform, like by the head, wrists, feet. Otherwise the physics sim will travel away from the armature and that's no good</li>
            </ul>
        </ol>
        <br>
        <h3>IMPORTANT NOTE: REVISIONS</h3>
        Revisions are super important for any workflow, here's how to efficiently re-export/re-import your Blender alembics without having to re-do any of the later steps.
        <ol>
            <li>Save the Maya scene and then export your Blender alembics, overwriting the existing files.</li>
            <li>When you re-open the Maya scene it will have the new animations you exported and you can run your physics simulation again! </li>
            <ul>
                <li>(Maya might crash if you try to keep going without re-opening the scene)</li>
            </ul>
        </ol>

        <a class="augmero-anchor" id="augmero-janchor-step4"></a>
        <p>
            <hr>
        </p><br>
        <h2>Step 4 - Export Ziva physics sim, import to Blender</h2>
        <p>I like step 4, don't have to do that much</p>
        <ol>
            <li>In Maya, select the mesh you want to export and click Cache -> Alembic Cache -> Export Selection to Alembic (this will play the animation as it's exporting)</li>
            <ul>
                <li><img src="https://i.imgur.com/elo06H2.png" alt="maya alembic export screenshot"></li>
            </ul>
            <li>In Blender import the file you just exported from Maya </li>
            <ul>
                <li><img src="https://i.imgur.com/0QR3tRU.png" alt="blender alembic import screenshot"></li>
            </ul>
        </ol>


        <a class="augmero-anchor" id="augmero-janchor-step5"></a>
        <p>
            <hr>
        </p><br>
        <h2>Step 5 - Mesh deform the original model in Blender</h2>
        <p>If you've gotten this far, I'm excited for you because it's time to see the results on the model</p>
        <p>Here's that screenshot of the modifier stack from earlier, but this is just the first two</p>
        <img src="https://i.imgur.com/lft8fgy.png" alt="First two modifiers screenshot">
        <p>After you bind the mesh deform, it's time to fix up the vertex group, pan around the animation and see if any vertices are messed up. This can be obvious or not so obvious depending on the animation. remove and add messed up vertices from the group until things look right</p>
        <p>If there are vertices that should be mesh deformed and aren't, that's also a problem with the original cage that was exported from Blender.</p>
        <p>Additionally, Mesh Deform isn't perfect and there will be some artifacting, I use corrective smooth modifier to help fix strangeness</p>
        <p>Next is just a matter of tweaking and other things and then rendering!</p>

        <a class="augmero-anchor" id="augmero-janchor-clothing"></a>
        <p>
            <hr>
        </p><br>

        <h2>Clothing</h2>
        <p>Some notes on clothes</p>
        <p>I've only started trying simple clothing very recently but the potential is there</p>
        <p>The simple bikini I made for Mercy Push-Ups was another two meshes following the zTissue flow. With the right material settings and attachments I was able to affect my main cage as well as keep the top close to the nipple area</p>

        <a class="augmero-anchor" id="augmero-janchor-expansion"></a>
        <p>
            <hr>
        </p><br>
        <h2>Expansion</h2>
        <p>Expansion / inflation fans, there's a lot of possibilities and potential here</p>
        <p>Two main ways I've found to change the proportions on your character with Ziva</p>
        <ol>
            <li>zMaterials with rest scale</li>
            <ul>
                <li>Pros: Fairly easy to set up</li>
                <li>Cons: For animating, you change the 'Rest Scale Envelope' on the Tissue, but this applies to all materials on that Tissue. So if you wanted to increase bust first and then back afterwards on the same Tissue this method won't work </li>
            </ul>
            <li>zRestShape</li>
            <ul>
                <li>Pros: Individual animation over time with envelopes</li>
                <li>Cons:</li>
                <ul>
                    <li>You have to export a different shape of your cage from Blender and import it in Maya</li>
                    <li>In some cases to lower artifacting you need to turn down the influence of the rest shape, however this makes the simulation less close to what the shape you exported from Blender looked like</li>
                </ul>
            </ul>
        </ol>

        <a class="augmero-anchor" id="augmero-janchor-resources"></a>
        <p>
            <hr>
        </p><br>
        <h2>Additional Links and Resources</h2>
        <p>Ziva first party documentation</p>
        <ul>
            <li><a href="https://zivadynamics.com/resources/fat-skin-workflow" target="_blank">Fat and Skin workflow</a>
            </li>
            <li><a href="https://docs.zivadynamics.com/vfx/nodes/zTissue.html?highlight=keyable" target="_blank">keyable (animate-able) properties of Ziva tissue</a></li>
            <li><a href="https://docs.zivadynamics.com/vfx/nodes/zMaterial.html#sec-zmaterial" target="_blank">https://docs.zivadynamics.com/vfx/nodes/zMaterial.html#sec-zmaterial</a>
            </li>
            <li><a href="https://docs.zivadynamics.com/vfx/mel_commands/zMeshCheck.html" target="_blank">zMeshCheck - info on commands for checking a mesh for problems</a></li>
            <!-- <li><a href=""></a></li> -->
        </ul>

        <p>If you're curious, the Ziva rabbit hole goes much further than the 'simple' simulations I've been doing. Here's some crazy forum posts I was looking at</p>
        <ul>
            <li><a href="https://community.zivadynamics.com/d/832-female-ectomorph-wip/73" target="_blank">female ectomorph wip (wow)</a>
            </li>
            <li><a href="https://community.zivadynamics.com/d/81-making-of-female-with-ziva/35" target="_blank">making of female with Ziva</a></li>
        </ul>


        <style type="text/css" media="screen">
            a.augmero-anchor {
                display: block;
                visibility: hidden;
            }
        </style>


    </div>






</body>

</html>
